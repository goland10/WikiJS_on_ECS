<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wiki.js AWS Architecture</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;600&display=swap');

  :root {
    --bg: #d0dce9;
    --surface: #e8f0f8;
    --surface2: #ffffff;
    --border: #8fa8c4;
    --accent:  #0355a0;
    --accent2: #b83a0a;
    --accent3: #03694a;
    --accent4: #5b21b6;
    --text:    #0c1524;
    --muted:   #3d5068;
    --az1: rgba(3, 85, 160, 0.07);
    --az2: rgba(91, 33, 182, 0.07);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  html { font-size: 125%; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'IBM Plex Sans', sans-serif;
    min-height: 100vh;
    padding: 32px 24px;
    background-image:
      radial-gradient(ellipse at 10% 20%, rgba(3,85,160,0.1) 0%, transparent 45%),
      radial-gradient(ellipse at 90% 80%, rgba(91,33,182,0.09) 0%, transparent 45%);
  }

  /* ===== HEADER ===== */
  header { text-align: center; margin-bottom: 28px; }
  header h1 {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 1rem; font-weight: 600;
    color: var(--accent);
    letter-spacing: 0.18em; text-transform: uppercase;
    margin-bottom: 5px;
  }
  header p {
    font-size: 0.7rem; color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
  }

  /* ===== OUTER LAYOUT ===== */
  .diagram { max-width: 1500px; margin: 0 auto; }

  .pipeline {
    display: flex;
    align-items: stretch;
    gap: 0;
  }

  /* ===== HORIZONTAL ARROW ===== */
  .h-connector {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
    flex-shrink: 0;
    gap: 3px;
    min-width: 52px;
  }
  .h-arrow-row { display: flex; align-items: center; }
  .h-shaft {
    height: 2px; width: 36px;
    background: linear-gradient(to right, var(--accent), rgba(3,85,160,0.2));
  }
  .h-head {
    width: 0; height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-left: 8px solid var(--accent);
  }
  .h-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.5rem; color: var(--muted);
    text-align: center; letter-spacing: 0.05em;
    white-space: nowrap;
  }
  .h-connector.green .h-shaft { background: linear-gradient(to right, var(--accent3), rgba(3,105,74,0.2)); }
  .h-connector.green .h-head  { border-left-color: var(--accent3); }
  .h-connector.orange .h-shaft { background: linear-gradient(to right, var(--accent2), rgba(184,58,10,0.2)); }
  .h-connector.orange .h-head  { border-left-color: var(--accent2); }

  /* ===== INTERNET ===== */
  .internet-col {
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .inet-pill {
    display: flex; flex-direction: column;
    align-items: center; gap: 5px;
    background: rgba(3,85,160,0.09);
    border: 1.5px solid rgba(3,85,160,0.35);
    border-radius: 14px; padding: 16px 14px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.65rem; color: var(--accent);
    font-weight: 600; letter-spacing: 0.04em;
  }
  .inet-pill .globe { font-size: 1.5rem; }

  /* ===== VPC BOX ===== */
  .vpc {
    flex: 1;
    border: 2px solid #6a9ec0;
    border-radius: 16px;
    padding: 14px;
    position: relative;
    background: rgba(208,224,236,0.5);
    box-shadow: 0 4px 22px rgba(0,0,0,0.11);
  }
  .zone-label {
    position: absolute; top: -11px; left: 16px;
    background: var(--bg); padding: 0 9px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.55rem; font-weight: 600;
    color: var(--accent); letter-spacing: 0.13em;
    text-transform: uppercase;
  }

  /* Three tiers L‚ÜíR inside VPC */
  .tiers {
    display: flex;
    align-items: stretch;
    height: 100%;
    gap: 0;
  }

  .tier {
    display: flex; flex-direction: column;
    flex: 1; min-width: 0;
  }
  /* App tier is wider to hold ECS + services panel */
  .tier.app { flex: 2; }

  .tier-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.54rem; font-weight: 600;
    letter-spacing: 0.11em; text-transform: uppercase;
    text-align: center; padding: 3px 6px 7px;
    white-space: nowrap;
  }
  .tier.web  .tier-label { color: var(--accent); }
  .tier.app  .tier-label { color: var(--accent3); }
  .tier.data .tier-label { color: var(--accent2); }

  /* ---- App tier inner: ECS top row + PrivateLink bottom row ---- */
  .app-inner {
    display: flex; flex-direction: column;
    gap: 10px; flex: 1;
  }

  /* ECS AZ boxes sit side-by-side */
  .ecs-row {
    display: flex; gap: 9px;
  }
  .ecs-row .az-box { flex: 1; }

  /* PrivateLink / managed services panel */
  .privatelink-panel {
    border: 1px dashed rgba(91,33,182,0.35);
    border-radius: 9px;
    padding: 9px;
    background: rgba(91,33,182,0.05);
  }
  .privatelink-header {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.5rem; font-weight: 600;
    letter-spacing: 0.1em; text-transform: uppercase;
    color: rgba(91,33,182,0.85);
    margin-bottom: 7px;
    display: flex; align-items: center; gap: 5px;
  }
  .services-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 6px;
  }
  .svc-card {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px; padding: 6px 8px;
    display: flex; align-items: center; gap: 6px;
    transition: border-color 0.2s, box-shadow 0.2s;
    cursor: default;
  }
  .svc-card:hover {
    border-color: rgba(91,33,182,0.5);
    box-shadow: 0 2px 7px rgba(0,0,0,0.09);
  }
  .svc-card .icon { width: 24px; height: 24px; font-size: 0.78rem; }
  .svc-name {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.56rem; font-weight: 600; color: var(--text);
  }
  .svc-sub { font-size: 0.5rem; color: var(--muted); margin-top: 1px; }

  /* ---- AZ stacks (web + data tiers) ---- */
  .az-stack {
    display: flex; flex-direction: column;
    gap: 9px; flex: 1;
  }
  .az-box {
    border-radius: 9px; padding: 9px; flex: 1;
  }
  .az-box.az-a { background: var(--az1); border: 1px dashed rgba(3,85,160,0.3); }
  .az-box.az-b { background: var(--az2); border: 1px dashed rgba(91,33,182,0.25); }

  .az-header {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.5rem; font-weight: 600;
    letter-spacing: 0.1em; text-transform: uppercase;
    margin-bottom: 6px;
  }
  .az-box.az-a .az-header { color: rgba(3,85,160,0.8); }
  .az-box.az-b .az-header { color: rgba(91,33,182,0.8); }

  /* ===== COMPONENT CARDS ===== */
  .component {
    display: flex; align-items: center; gap: 7px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 7px; padding: 7px 9px;
    margin-bottom: 5px;
    transition: border-color 0.2s, transform 0.15s, box-shadow 0.2s;
    cursor: default;
  }
  .component:last-child { margin-bottom: 0; }
  .component:hover {
    border-color: rgba(3,85,160,0.55);
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  }

  .icon {
    width: 28px; height: 28px;
    border-radius: 5px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.9rem; flex-shrink: 0;
  }
  .icon.alb { background: rgba(3,85,160,0.13); }
  .icon.ecs { background: rgba(3,105,74,0.13); }
  .icon.rds { background: rgba(184,58,10,0.13); }
  .icon.ecr { background: rgba(91,33,182,0.13); }
  .icon.s3  { background: rgba(160,100,0,0.13); }
  .icon.sm  { background: rgba(160,20,60,0.13); }
  .icon.cw  { background: rgba(8,90,120,0.13); }
  .icon.ep  { background: rgba(60,75,95,0.13); }
  .icon.as  { background: rgba(3,105,74,0.1); }

  .comp-info { flex: 1; min-width: 0; }
  .comp-name {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.62rem; font-weight: 600; color: var(--text);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .comp-desc {
    font-size: 0.55rem; color: var(--muted);
    margin-top: 2px; line-height: 1.3;
  }

  .badge {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.48rem; padding: 2px 5px;
    border-radius: 4px; font-weight: 600;
    white-space: nowrap; flex-shrink: 0;
  }
  .badge.fargate { background: rgba(3,105,74,0.1);  color: #03694a; border: 1px solid rgba(3,105,74,0.3); }
  .badge.multiaz { background: rgba(184,58,10,0.1); color: #b83a0a; border: 1px solid rgba(184,58,10,0.3); }
  .badge.pg17    { background: rgba(184,58,10,0.1); color: #b83a0a; border: 1px solid rgba(184,58,10,0.3); }
  .badge.tls     { background: rgba(3,85,160,0.1);  color: #0355a0; border: 1px solid rgba(3,85,160,0.3); }
  .badge.selfsigned { background: rgba(160,20,60,0.08); color: #a01440; border: 1px solid rgba(160,20,60,0.25); }

  /* ===== ROW-BASED AZ LAYOUT ===== */
  .az-row {
    display: flex;
    align-items: stretch;
    gap: 0;
  }
  .az-row-label {
    writing-mode: vertical-rl;
    text-orientation: mixed;
    transform: rotate(180deg);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.52rem;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 0 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    flex-shrink: 0;
    margin-right: 8px;
  }
  .az-a-label { color: rgba(3,85,160,0.8); background: var(--az1); border: 1px dashed rgba(3,85,160,0.25); }
  .az-b-label { color: rgba(91,33,182,0.8); background: var(--az2); border: 1px dashed rgba(91,33,182,0.22); }

  .az-row-content {
    display: flex;
    align-items: stretch;
    flex: 1;
    gap: 0;
  }

  /* Each tier cell within a row */
  .az-cell {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-width: 0;
  }

  /* Tier label shown only on first (AZ-A) row */
  .cell-tier-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.52rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    text-align: center;
    padding: 2px 4px 6px;
    white-space: nowrap;
  }
  .cell-tier-label.web  { color: var(--accent); }
  .cell-tier-label.app  { color: var(--accent3); }
  .cell-tier-label.data { color: var(--accent2); }

  /* Compact RDS boxes so sync arrow fits between rows */
  .rds-box { padding: 6px !important; }
  .rds-comp { padding: 5px 8px !important; margin-bottom: 0 !important; }

  /* Spacer that pushes sync arrow to align over the data column.
     Matches: az-row-label(~34px) + az-cell(flex:1) + h-connector(52px) + az-cell(flex:1.4) + h-connector(52px) */
  .sync-spacer {
    flex-shrink: 0;
    width: calc(34px + 52px + 52px);
    /* The two flex cells take up the rest; we need to push past them.
       Use the same flex ratio to align: web(1) + app(1.4) out of total 3.4 */
    flex: 2.4;
  }

  /* ===== LEGEND ===== */
  .legend {
    display: flex; flex-wrap: wrap; gap: 14px;
    justify-content: center;
    margin-top: 18px; padding-top: 14px;
    border-top: 1px solid var(--border);
  }
  .legend-item {
    display: flex; align-items: center; gap: 5px;
    font-size: 0.58rem; color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
  }
  .legend-dot { width: 9px; height: 9px; border-radius: 50%; }

  /* Animations */
  @keyframes fadeInRight {
    from { opacity: 0; transform: translateX(-8px); }
    to   { opacity: 1; transform: translateX(0); }
  }
  .internet-col { animation: fadeInRight 0.35s ease both 0s; }
  .vpc          { animation: fadeInRight 0.35s ease both 0.12s; }
</style>
</head>
<body>

<header>
  <h1>Wiki.js ¬∑ AWS Architecture</h1>
  <p>Three-tier ¬∑ Fargate ¬∑ Multi-AZ ¬∑ Zero-Trust Networking</p>
</header>

<div class="diagram">
  <div class="pipeline">

    <!-- ‚ë† INTERNET -->
    <div class="internet-col">
      <div class="inet-pill">
        <span class="globe">üåê</span>
        <span>Internet</span>
        <span>/ Users</span>
      </div>
    </div>

    <!-- ‚Üí ALB -->
    <div class="h-connector">
      <div class="h-arrow-row">
        <div class="h-shaft"></div>
        <div class="h-head"></div>
      </div>
      <span class="h-label">80‚Üí443</span>
    </div>

    <!-- ‚ë° VPC -->
    <div class="vpc">
      <span class="zone-label">AWS VPC ‚Äî Custom</span>

      <!-- Tier column headers ‚Äî outside AZ rows so they don't affect box sizing -->
      <div style="display:flex; align-items:stretch; gap:0; margin-bottom:6px; padding-left: 34px;">
        <div style="flex:1; text-align:center;">
          <div class="cell-tier-label web">üåê Web Tier ¬∑ Public</div>
        </div>
        <div style="min-width:52px;"></div>
        <div style="flex:1.4; text-align:center;">
          <div class="cell-tier-label app">üê≥ App Tier ¬∑ Private</div>
        </div>
        <div style="min-width:52px;"></div>
        <div style="flex:1; text-align:center;">
          <div class="cell-tier-label data">üóÑÔ∏è Data Tier ¬∑ Private</div>
        </div>
      </div>

      <!-- AZ-A ROW -->
      <div class="az-row">
        <div class="az-row-label az-a-label">‚¨° AZ-A</div>
        <div class="az-row-content">

          <div class="az-cell">
            <div class="az-box az-a" style="flex:1;">
              <div class="component">
                <div class="icon alb">‚öñÔ∏è</div>
                <div class="comp-info">
                  <div class="comp-name">ALB ‚Äî HTTPS :443</div>
                  <div class="comp-desc">Forward ‚Üí target group</div>
                </div>
                <span class="badge tls">TLS</span>
              </div>
              <div class="component">
                <div class="icon alb">‚Ü©Ô∏è</div>
                <div class="comp-info">
                  <div class="comp-name">ALB ‚Äî HTTP :80</div>
                  <div class="comp-desc">301 redirect ‚Üí HTTPS</div>
                </div>
              </div>
            </div>
          </div>

          <div class="h-connector green" style="align-self:center;">
            <div class="h-arrow-row"><div class="h-shaft"></div><div class="h-head"></div></div>
            <span class="h-label">target group</span>
          </div>

          <div class="az-cell" style="flex:1.4;">
            <div class="az-box az-a" style="flex:1;">
              <div class="component">
                <div class="icon ecs">üê≥</div>
                <div class="comp-info">
                  <div class="comp-name">ECS Fargate</div>
                  <div class="comp-desc">Wiki.js container</div>
                </div>
                <span class="badge fargate">FARGATE</span>
              </div>
              <div class="component">
                <div class="icon as">üìà</div>
                <div class="comp-info">
                  <div class="comp-name">Auto Scaling</div>
                  <div class="comp-desc">CPU target tracking</div>
                </div>
              </div>
            </div>
          </div>

          <div class="h-connector orange" style="align-self:center;">
            <div class="h-arrow-row"><div class="h-shaft"></div><div class="h-head"></div></div>
            <span class="h-label">port 5432</span>
          </div>

          <div class="az-cell">
            <div class="az-box az-a rds-box">
              <div class="component rds-comp">
                <div class="icon rds">üóÑÔ∏è</div>
                <div class="comp-info">
                  <div class="comp-name">RDS PostgreSQL 17</div>
                  <div class="comp-desc">Primary instance</div>
                </div>
                <span class="badge pg17">PG17</span>
              </div>
            </div>
          </div>

        </div>
      </div><!-- /AZ-A row -->

      <!-- Sync arrow row ‚Äî only visible over the data column -->
      <div style="display:flex; align-items:center; margin:0;">
        <!-- spacer matching: az-row-label + web cell + h-connector + app cell + h-connector -->
        <div class="sync-spacer"></div>
        <!-- the arrow itself -->
        <div style="flex:1; display:flex; flex-direction:column; align-items:center; padding:2px 0; gap:1px;">
          <div style="width:2px; height:10px; background: linear-gradient(to bottom, var(--accent2), rgba(184,58,10,0.3));"></div>
          <div style="width:0; height:0; border-left:4px solid transparent; border-right:4px solid transparent; border-top:6px solid var(--accent2); opacity:0.75;"></div>
          <span style="font-family:'IBM Plex Mono',monospace; font-size:0.42rem; color:var(--accent2); letter-spacing:0.06em;">sync replication</span>
        </div>
      </div>

      <!-- AZ-B ROW -->
      <div class="az-row">
        <div class="az-row-label az-b-label">‚¨° AZ-B</div>
        <div class="az-row-content">

          <div class="az-cell">
            <div class="az-box az-b" style="flex:1;">
              <div class="component">
                <div class="icon alb">‚öñÔ∏è</div>
                <div class="comp-info">
                  <div class="comp-name">ALB ‚Äî HTTPS :443</div>
                  <div class="comp-desc">Forward ‚Üí target group</div>
                </div>
                <span class="badge tls">TLS</span>
              </div>
              <div class="component">
                <div class="icon alb">‚Ü©Ô∏è</div>
                <div class="comp-info">
                  <div class="comp-name">ALB ‚Äî HTTP :80</div>
                  <div class="comp-desc">301 redirect ‚Üí HTTPS</div>
                </div>
              </div>
            </div>
          </div>

          <div class="h-connector green" style="align-self:center;">
            <div class="h-arrow-row"><div class="h-shaft"></div><div class="h-head"></div></div>
            <span class="h-label">target group</span>
          </div>

          <div class="az-cell" style="flex:1.4;">
            <div class="az-box az-b" style="flex:1;">
              <div class="component">
                <div class="icon ecs">üê≥</div>
                <div class="comp-info">
                  <div class="comp-name">ECS Fargate</div>
                  <div class="comp-desc">Wiki.js container</div>
                </div>
                <span class="badge fargate">FARGATE</span>
              </div>
              <div class="component">
                <div class="icon as">üìà</div>
                <div class="comp-info">
                  <div class="comp-name">Auto Scaling</div>
                  <div class="comp-desc">CPU target tracking</div>
                </div>
              </div>
            </div>
          </div>

          <div class="h-connector orange" style="align-self:center;">
            <div class="h-arrow-row"><div class="h-shaft"></div><div class="h-head"></div></div>
            <span class="h-label">port 5432</span>
            <span class="h-label">‚Üí primary</span>
          </div>

          <div class="az-cell">
            <div class="az-box az-b rds-box" style="opacity:0.85;">
              <div class="component rds-comp" style="border-style:dashed;">
                <div class="icon rds">üóÑÔ∏è</div>
                <div class="comp-info">
                  <div class="comp-name">RDS PostgreSQL 17</div>
                  <div class="comp-desc">Standby ¬∑ no direct writes</div>
                </div>
                <span class="badge multiaz">MULTI-AZ</span>
              </div>
            </div>
          </div>

        </div>
      </div><!-- /AZ-B row -->

      <!-- Column-aligned panels: ACM below Web, PrivateLink below App -->
      <div style="display:flex; align-items:flex-start; gap:0; margin-top:8px; padding-left:34px;">

        <!-- ACM below Web Tier -->
        <div style="flex:1;">
          <div class="component" style="border-color: rgba(160,20,60,0.3); background: rgba(160,20,60,0.03); margin-bottom:0;">
            <div class="icon sm">üîè</div>
            <div class="comp-info">
              <div class="comp-name">ACM Certificate</div>
              <div class="comp-desc">Self-signed ¬∑ wikijs.internal ¬∑ RSA 2048</div>
            </div>
            <span class="badge selfsigned">RSA</span>
          </div>
        </div>

        <!-- spacer matching h-connector width -->
        <div style="min-width:52px;"></div>

        <!-- empty App Tier col -->
        <div style="flex:1.4;"></div>

        <!-- spacer matching h-connector width -->
        <div style="min-width:52px;"></div>

        <!-- PrivateLink below Data Tier -->
        <div style="flex:1;">
          <div class="privatelink-panel" style="margin-bottom:0;">
            <div class="privatelink-header">üîó VPC PrivateLink ‚Äî Managed Services (no NAT)</div>
            <div class="services-grid">
              <div class="svc-card">
                <div class="icon ecr">üì¶</div>
                <div><div class="svc-name">Amazon ECR</div><div class="svc-sub">Container images</div></div>
              </div>
              <div class="svc-card">
                <div class="icon s3">ü™£</div>
                <div><div class="svc-name">Amazon S3</div><div class="svc-sub">Config / assets</div></div>
              </div>
              <div class="svc-card">
                <div class="icon sm">üîê</div>
                <div><div class="svc-name">Secrets Manager</div><div class="svc-sub">DB credentials</div></div>
              </div>
              <div class="svc-card">
                <div class="icon cw">üìä</div>
                <div><div class="svc-name">CloudWatch</div><div class="svc-sub">Logs & metrics</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /vpc -->

  </div><!-- /pipeline -->

  <!-- Legend -->
  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:rgba(3,85,160,0.85)"></div>Public Subnet</div>
    <div class="legend-item"><div class="legend-dot" style="background:rgba(3,105,74,0.85)"></div>Private App Subnet</div>
    <div class="legend-item"><div class="legend-dot" style="background:rgba(184,58,10,0.85)"></div>Private DB Subnet</div>
    <div class="legend-item"><div class="legend-dot" style="background:rgba(91,33,182,0.85)"></div>PrivateLink / Managed Services</div>
    <div class="legend-item">üîí Zero-trust ¬∑ no NAT ¬∑ least-privilege SGs ¬∑ secrets injected at runtime</div>
  </div>
</div>

</body>
</html>